import os
import shutil

# Set the path to the directory containing your files and folders
directory = r"C:\path\to\your\directory"

# Manually map a keyword (partial match in filename) to actual folder name
folder_mapping = {
    "general accounting": "06 2025 General Accounting EOC",
    "audit": "2025 Audit Wrapup",
    "payroll": "July 2025 Payroll Submissions"
}

# File types to include
email_extensions = ['.msg', '.eml']
excel_extensions = ['.xls', '.xlsx', '.xlsm', '.xlsb']

# Normalize mapping for lowercase comparison
normalized_mapping = {k.lower(): v for k, v in folder_mapping.items()}

# Loop through each file in the directory
for filename in os.listdir(directory):
    file_path = os.path.join(directory, filename)

    # Skip if it's a directory
    if os.path.isdir(file_path):
        continue

    _, ext = os.path.splitext(filename)
    ext = ext.lower()

    # Skip non-email/non-excel files
    if ext not in email_extensions + excel_extensions:
        continue

    file_lower = filename.lower()
    matched = False

    for keyword, folder_name in normalized_mapping.items():
        if keyword in file_lower:
            target_folder = os.path.join(directory, folder_name)
            if os.path.isdir(target_folder):
                destination = os.path.join(target_folder, filename)
                shutil.move(file_path, destination)
                print(f"✅ Moved: {filename} → {folder_name}")
                matched = True
                break
            else:
                print(f"⚠️ Folder not found: {folder_name} for keyword '{keyword}'")
                matched = True
                break

    if not matched:
        print(f"❌ No match for file: {filename}")