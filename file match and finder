import os
import shutil

# Set your main directory path
directory = r"C:\path\to\your\directory"

# Define keywords and their matching folder keywords
# You can expand this list to whatever makes sense for you
keywords = [
    "general accounting",
    "audit",
    "payroll",
    "finance",
    "risk"
]

# Normalize everything to lowercase for easier comparison
lower_keywords = [k.lower() for k in keywords]

# Get all subfolders in the directory
subfolders = [f for f in os.listdir(directory) if os.path.isdir(os.path.join(directory, f))]

# Define file extensions
email_extensions = ['.msg', '.eml']
excel_extensions = ['.xls', '.xlsx', '.xlsm', '.xlsb']

# Loop through files in the directory
for filename in os.listdir(directory):
    file_path = os.path.join(directory, filename)

    if os.path.isdir(file_path):
        continue

    _, ext = os.path.splitext(filename)
    ext = ext.lower()

    # Only process email and Excel files
    if ext in email_extensions + excel_extensions:
        file_lower = filename.lower()

        matched = False
        for keyword in lower_keywords:
            if keyword in file_lower:
                # Now look for a folder with this keyword
                for folder in subfolders:
                    if keyword in folder.lower():
                        target_folder = os.path.join(directory, folder)
                        destination = os.path.join(target_folder, filename)
                        shutil.move(file_path, destination)
                        print(f"Moved {filename} -> {folder}")
                        matched = True
                        break
            if matched:
                break

        if not matched:
            print(f"⚠️ No matching folder found for: {filename}")